"use strict";Array.prototype.forEach||(Array.prototype.forEach=function(n,e){var t=void 0,a=void 0;if(null==this)throw new TypeError("this is null or not defined");var o=void 0,i=Object(this),r=i.length>>>0;if("[object Function]"!=={}.toString.call(n))throw new TypeError(n+" is not a function");for(2<=arguments.length&&(t=e),a=0;a<r;)a in i&&(o=i[a],n.call(t,o,a,i)),a++});var _createClass=function(){function a(n,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,a.key,a)}}return function(n,e,t){return e&&a(n.prototype,e),t&&a(n,t),n}}();function _classCallCheck(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var Document=function(){function t(n){_classCallCheck(this,t),this.callbacks=[],this.eventNamesToListen=n;var e=this;this._notified=!1,this.listener=function(){e._notifyReady(e.callbacks)}}return _createClass(t,[{key:"begin",value:function(){document.addEventListener(this.eventNamesToListen.document,this.listener),window.addEventListener(this.eventNamesToListen.window,this.listener)}},{key:"end",value:function(){this._notified=!1,document.removeEventListener(this.eventNamesToListen.document,this.listener),window.removeEventListener(this.eventNamesToListen.window,this.listener),this.callbacks=[]}},{key:"ready",value:function(n){this.callbacks.push(n)}},{key:"_notifyReady",value:function(n){this._notified||(this._notified=!0,n.forEach(function(n){n()}),n=[])}},{key:"_documentIsReady",value:function(){var n=document.readyState,e=document.documentElement.doScroll;return!("complete"!==n)||!("loading"===n)&&!e}}]),t}();window.RayNS=window.RayNS||{},window.RayNS.Document=Document;_createClass=function(){function a(n,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,a.key,a)}}return function(n,e,t){return e&&a(n.prototype,e),t&&a(n,t),n}}();function _classCallCheck(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var Commands=function(){function n(){_classCallCheck(this,n)}return _createClass(n,null,[{key:"EXECUTE_NEW_COMPONENTS",get:function(){return"ray.command.execute-new-components"}}]),n}();window.RayNS=window.RayNS||{},window.RayNS.Commands=Commands;_createClass=function(){function a(n,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,a.key,a)}}return function(n,e,t){return e&&a(n.prototype,e),t&&a(n,t),n}}();function _classCallCheck(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var Events=function(){function n(){_classCallCheck(this,n)}return _createClass(n,null,[{key:"ERROR",get:function(){return"ray.event.error"}}]),n}();window.RayNS=window.RayNS||{},window.RayNS.Events=Events;_createClass=function(){function a(n,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,a.key,a)}}return function(n,e,t){return e&&a(n.prototype,e),t&&a(n,t),n}}();function _classCallCheck(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var ComponentData=function(){function a(n,e,t){_classCallCheck(this,a),this.DOMElement=n,this.bus=e,this.commandDispatcher=t}return _createClass(a,[{key:"_init",value:function(){this.topics={},this.id=0}}],[{key:"create",value:function(n,e,t){return new a(n,e,t)}}]),a}();window.RayNS=window.RayNS||{},window.RayNS.ComponentData=ComponentData;_createClass=function(){function a(n,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,a.key,a)}}return function(n,e,t){return e&&a(n.prototype,e),t&&a(n,t),n}}();function _classCallCheck(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var Component=function(){function r(n,e){_classCallCheck(this,r),this.componentConstructorFn=n,this.data=e}return _createClass(r,[{key:"execute",value:function(){return new this.componentConstructorFn(this.data)}}],[{key:"create",value:function(n,e){var t=RayNS.ComponentData.create(n,e),a=n.getAttribute(r.DATA_RAY_ATTR),o=a.split(".").pop(),i=function(n){var e=n.split(".");e.pop();var t=window;return e.forEach(function(n){t=t[n]}),t}(a)[o];if(void 0===i)throw new Error("<"+o+"> JS object not Found");return new r(i,t)}},{key:"DATA_RAY_ATTR",get:function(){return"data-ray-component"}}]),r}();window.RayNS=window.RayNS||{},window.RayNS.Component=Component;_createClass=function(){function a(n,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,a.key,a)}}return function(n,e,t){return e&&a(n.prototype,e),t&&a(n,t),n}}();function _classCallCheck(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Component=RayNS.Component,Events=RayNS.Events,Commands=RayNS.Commands;var CommandDispatcher=function(){function e(n){_classCallCheck(this,e),this.bus=n}return _createClass(e,[{key:"begin",value:function(){var n=this;this.listenerToExecNewComponents=this.bus.on(Commands.EXECUTE_NEW_COMPONENTS,function(){n._executeNewComponents()})}},{key:"end",value:function(){this.bus.off(this.listenerToExecNewComponents)}},{key:"_executeNewComponents",value:function(){var n=RayNS.Component.DATA_RAY_ATTR,t=this;return document.querySelectorAll("["+n+"]").forEach(function(n){try{var e="data-ray-component-executed";if(n.hasAttribute(e))return;n.setAttribute(e,""),Component.create(n,t.bus).execute()}catch(n){t.bus.trigger(Events.ERROR,n),console.log("RayJS: Error loading components: "+n.message)}})}}]),e}();window.RayNS=window.RayNS||{},window.RayNS.CommandDispatcher=CommandDispatcher;_createClass=function(){function a(n,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,a.key,a)}}return function(n,e,t){return e&&a(n.prototype,e),t&&a(n,t),n}}();function _classCallCheck(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var Bus=function(){function n(){_classCallCheck(this,n),this._init()}return _createClass(n,[{key:"_init",value:function(){this.topics={},this.id=0}},{key:"on",value:function(n,e){return this.topics[n]||(this.topics[n]=[]),this.id++,this.topics[n].push({id:this.id,callback:e}),this.id}},{key:"off",value:function(n){for(var e in this.topics){if(!this.topics[e])return!1;for(var t=0,a=this.topics[e].length;t<a;t++)if(this.topics[e][t].id===n)return this.topics[e].splice(t,1),!0}return!1}},{key:"end",value:function(){this._init()}},{key:"trigger",value:function(n,e){if(!this.topics[n])return!1;var t=this.topics[n];return t?(t.forEach(function(n){n.callback(e)}),!0):void 0}}],[{key:"create",value:function(){return new n}}]),n}();window.RayNS=window.RayNS||{},window.RayNS.Bus=Bus;_createClass=function(){function a(n,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,a.key,a)}}return function(n,e,t){return e&&a(n.prototype,e),t&&a(n,t),n}}();function _classCallCheck(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Commands=RayNS.Commands;var Ray=function(){function e(n){_classCallCheck(this,e),this.eventNamesToListen=n||{document:"DOMContentLoaded",window:"load"},this.raydocument=new RayNS.Document(this.eventNamesToListen),this.bus=RayNS.Bus.create(),this.commandDispatcher=new RayNS.CommandDispatcher(this.bus)}return _createClass(e,[{key:"begin",value:function(){this.commandDispatcher.begin(),this.raydocument.begin();var n=this;this.raydocument.ready(function(){n.bus.trigger(Commands.EXECUTE_NEW_COMPONENTS)}),this.intervalId=setInterval(function(){n.bus.trigger(Commands.EXECUTE_NEW_COMPONENTS)},400)}},{key:"end",value:function(){clearInterval(this.intervalId),this.raydocument.end(),this.bus.end(),this.commandDispatcher.end()}}],[{key:"createBus",value:function(){return RayNS.Bus.create()}},{key:"createComponent",value:function(n,e){return RayNS.Component.create(n,e)}},{key:"Events",get:function(){return RayNS.Events}},{key:"Commands",get:function(){return RayNS.Commands}}]),e}();window.RayNS=window.RayNS||{},window.RayNS.Ray=Ray,module.exports=Ray;