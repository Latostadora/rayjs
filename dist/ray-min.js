"use strict";Array.prototype.forEach||(Array.prototype.forEach=function(e,n){var t=void 0,a=void 0;if(null==this)throw new TypeError("this is null or not defined");var o=void 0,i=Object(this),r=i.length>>>0;if("[object Function]"!=={}.toString.call(e))throw new TypeError(e+" is not a function");for(2<=arguments.length&&(t=n),a=0;a<r;)a in i&&(o=i[a],e.call(t,o,a,i)),a++});var _createClass=function(){function a(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,n,t){return n&&a(e.prototype,n),t&&a(e,t),e}}();function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var Document=function(){function t(e){_classCallCheck(this,t),this.callbacks=[],this.eventNamesToListen=e;var n=this;this._notified=!1,this.listener=function(){n._notifyReady(n.callbacks)}}return _createClass(t,[{key:"begin",value:function(){document.addEventListener(this.eventNamesToListen.document,this.listener),window.addEventListener(this.eventNamesToListen.window,this.listener)}},{key:"end",value:function(){this._notified=!1,document.removeEventListener(this.eventNamesToListen.document,this.listener),window.removeEventListener(this.eventNamesToListen.window,this.listener),this.callbacks=[]}},{key:"ready",value:function(e){this.callbacks.push(e)}},{key:"_notifyReady",value:function(e){this._notified||(this._notified=!0,e.forEach(function(e){e()}),e=[])}},{key:"_documentIsReady",value:function(){var e=document.readyState,n=document.documentElement.doScroll;return!("complete"!==e)||!("loading"===e)&&!n}}]),t}();window.RayNS=window.RayNS||{},window.RayNS.Document=Document;_createClass=function(){function a(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,n,t){return n&&a(e.prototype,n),t&&a(e,t),e}}();function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var ComponentData=function(){function a(e,n,t){_classCallCheck(this,a),this.DOMElement=e,this.bus=n,this.commandDispatcher=t}return _createClass(a,[{key:"_init",value:function(){this.topics={},this.id=0}}],[{key:"create",value:function(e,n,t){return new a(e,n,t)}}]),a}();window.RayNS=window.RayNS||{},window.RayNS.ComponentData=ComponentData;_createClass=function(){function a(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,n,t){return n&&a(e.prototype,n),t&&a(e,t),e}}();function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var Component=function(){function r(e,n){_classCallCheck(this,r),this.componentConstructorFn=e,this.data=n}return _createClass(r,[{key:"execute",value:function(){return new this.componentConstructorFn(this.data)}}],[{key:"create",value:function(e,n){var t=RayNS.ComponentData.create(e,n),a=e.getAttribute(r.DATA_RAY_ATTR),o=a.split(".").pop(),i=function(e){var n=e.split(".");n.pop();var t=window;return n.forEach(function(e){t=t[e]}),t}(a)[o];if(void 0===i)throw new Error("<"+o+"> JS object not Found");return new r(i,t)}},{key:"DATA_RAY_ATTR",get:function(){return"data-ray-component"}}]),r}();window.RayNS=window.RayNS||{},window.RayNS.Component=Component;_createClass=function(){function a(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,n,t){return n&&a(e.prototype,n),t&&a(e,t),e}}();function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Component=RayNS.Component;var CommandDispatcher=function(){function n(e){_classCallCheck(this,n),this.eventBus=e}return _createClass(n,[{key:"loadNewComponents",value:function(){var e=RayNS.Component.DATA_RAY_ATTR,t=this;return document.querySelectorAll("["+e+"]").forEach(function(e){try{var n="data-ray-component-executed";if(e.hasAttribute(n))return;e.setAttribute(n,""),Component.create(e,t.eventBus).execute()}catch(e){t.eventBus.trigger("ray.error",e),console.log("RayJS: Error loading components: "+e.message)}})}}]),n}();window.RayNS=window.RayNS||{},window.RayNS.CommandDispatcher=CommandDispatcher;_createClass=function(){function a(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,n,t){return n&&a(e.prototype,n),t&&a(e,t),e}}();function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var Bus=function(){function e(){_classCallCheck(this,e),this._init()}return _createClass(e,[{key:"_init",value:function(){this.topics={},this.id=0}},{key:"on",value:function(e,n){return this.topics[e]||(this.topics[e]=[]),this.id++,this.topics[e].push({id:this.id,callback:n}),this.id}},{key:"off",value:function(e){for(var n in this.topics){if(!this.topics[n])return!1;for(var t=0,a=this.topics[n].length;t<a;t++)if(this.topics[n][t].id===e)return this.topics[n].splice(t,1),!0}return!1}},{key:"end",value:function(){this._init()}},{key:"trigger",value:function(n,t){if(!this.topics[n])return!1;var a=this;return setTimeout(function(){var e=a.topics[n];e&&e.forEach(function(e){e.callback(t)})},0),!0}}],[{key:"create",value:function(){return new e}}]),e}();window.RayNS=window.RayNS||{},window.RayNS.Bus=Bus;_createClass=function(){function a(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,n,t){return n&&a(e.prototype,n),t&&a(e,t),e}}();function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var Ray=function(){function n(e){_classCallCheck(this,n),this.eventNamesToListen=e||{document:"DOMContentLoaded",window:"load"},this.raydocument=new RayNS.Document(this.eventNamesToListen),this.eventBus=RayNS.Bus.create(),this.commandDispatcher=new RayNS.CommandDispatcher(this.eventBus)}return _createClass(n,[{key:"begin",value:function(){this.raydocument.begin();var e=this;this.raydocument.ready(function(){e.commandDispatcher.loadNewComponents()}),this.intervalId=setInterval(function(){e.commandDispatcher.loadNewComponents()},400)}},{key:"end",value:function(){clearInterval(this.intervalId),this.raydocument.end(),this.eventBus.end()}},{key:"getCommandDispatcher",value:function(){return this.commandDispatcher}}],[{key:"createBus",value:function(){return RayNS.Bus.create()}},{key:"createComponent",value:function(e,n){return RayNS.Component.create(e,n)}}]),n}();window.RayNS=window.RayNS||{},window.RayNS.Ray=Ray;